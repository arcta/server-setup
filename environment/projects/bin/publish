#!/bin/bash

########################################################################
### publish notebook to the web as static html + pdf
### parameters: $1 project subdirectory; $2 notebook name
### options: --pdf
########################################################################
source ~/.local.cnf

path="${2/.ipynb/}"
file=$(basename $path)
dir=$(dirname $path)
if ! [ -d ~/projects/${1}/app/static/${dir} ]; then
    mkdir ~/projects/${1}/app/static/${dir}
fi

if [ -f ~/projects/${1}/${path}.ipynb ]; then
    cd ~/projects/${1}/app/static
    if [ "$3" = "--pdf" ]; then
        jupyter nbconvert --to pdf ~/projects/${1}/${path}.ipynb
        mv ~/projects/${1}/${path}.pdf ${file}.pdf
        rm ~/projects/${1}/${dir}/notebook.tex
        echo "Location: $NODEIP/projects/${1}/${file}.pdf"
    else
        jupyter nbconvert --to html ~/projects/${1}/${path}.ipynb
        mv ~/projects/${1}/${path}.html ${path}.html
        sed -i -r "s/https?:\/\/${NODEIP}:[0-9]{4}\///g" ${path}.html
        echo "Location: $NODEIP/projects/${1}/${path}.html"
    fi
else
    echo "File ~/projects/${1}/${path}.ipynb does not exist."
fi
